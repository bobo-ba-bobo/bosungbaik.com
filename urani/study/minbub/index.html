<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Urani Minbub Ganbare <3</title>
<link rel="stylesheet" href="../../../style.css">
<style>
/* Additional styles for mode selection */
body {
  background: #fff;
}

nav {
  border-bottom: 1px solid #e0e0e0;
}

nav .container {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

nav h1 {
  font-size: 15px;
  font-weight: 500;
  margin-bottom: 0;
}

.nav-stats {
  display: flex;
  gap: 14px;
  font-size: 12px;
  color: #616161;
  align-items: center;
}

.nav-stats b {
  color: #000;
}

.btn {
  padding: 8px 14px;
  border: 1px solid #000;
  background: #000;
  color: #fff;
  font-size: 12px;
  font-weight: 400;
  cursor: pointer;
  transition: all 0.2s;
}

.btn:hover {
  background: #fff;
  color: #000;
}

.btn-ghost {
  background: transparent;
  color: #000;
  border-color: #e0e0e0;
}

.btn-ghost:hover {
  background: #000;
  color: #fff;
}

.mode-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 20px;
  margin-top: 50px;
}

@media (max-width: 640px) {
  .mode-grid {
    grid-template-columns: 1fr;
  }
}

.mode-card {
  border: 1px solid #e0e0e0;
  padding: 30px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  text-decoration: none;
  color: #000;
}

.mode-card:hover {
  border-color: #000;
  background: #f5f5f5;
}

.mode-card .icon {
  font-size: 36px;
  margin-bottom: 16px;
}

.mode-card h2 {
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 8px;
  text-transform: none;
  letter-spacing: -0.01em;
}

.mode-card p {
  font-size: 13px;
  color: #616161;
  margin-bottom: 0;
}

.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
  margin-bottom: 30px;
}

@media (max-width: 640px) {
  .stats-grid {
    grid-template-columns: 1fr;
  }
}

.stat-card {
  border: 1px solid #e0e0e0;
  padding: 16px;
  text-align: center;
}

.stat-card h3 {
  font-size: 10px;
  color: #616161;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 8px;
  font-weight: 500;
}

.stat-card .num {
  font-size: 28px;
  font-weight: 500;
  color: #000;
}

/* Modal */
.modal-bg {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  z-index: 200;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.modal-bg.show {
  display: flex;
}

.modal {
  background: #fff;
  max-width: 400px;
  width: 100%;
  padding: 24px;
  border: 1px solid #000;
}

.modal h2 {
  font-size: 16px;
  margin-bottom: 6px;
  text-transform: none;
  letter-spacing: -0.01em;
}

.modal p {
  font-size: 13px;
  color: #616161;
  margin-bottom: 20px;
}

.modal label {
  font-size: 12px;
  color: #616161;
  display: block;
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.modal input[type=password] {
  width: 100%;
  padding: 10px;
  background: #fff;
  border: 1px solid #e0e0e0;
  color: #000;
  font-size: 14px;
  margin-bottom: 16px;
  outline: none;
}

.modal input[type=password]:focus {
  border-color: #000;
}

.modal .error {
  display: none;
  color: #000;
  background: #f5f5f5;
  padding: 8px;
  font-size: 12px;
  margin-bottom: 12px;
}

.modal .btn-group {
  display: flex;
  gap: 8px;
}

.modal .btn {
  flex: 1;
}

.modal .hint {
  font-size: 11px;
  color: #999;
  margin-top: 16px;
  text-align: center;
}
</style>
</head>
<body>

<nav>
  <div class="container">
    <h1>Urani Minbub Ganbare <3</h1>
    <div class="nav-stats">
      <span id="sync-status" style="display:none;margin-right:8px;color:#000;font-size:11px">â˜ï¸ ë™ê¸°í™”</span>
      <button id="login-btn" class="btn btn-ghost" onclick="showLoginModal()" style="padding:5px 10px;font-size:11px">ë¡œê·¸ì¸</button>
      <span id="user-info" style="display:none;font-size:11px">ğŸ”’ ë¡œê·¸ì¸ë¨</span>
      <button id="logout-btn" class="btn btn-ghost" onclick="handleLogout()" style="display:none;padding:5px 10px;font-size:11px">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>
</nav>

<main>
  <div class="container">
    <section>
      <h1>ë¯¼ë²•ì˜ ë§¥</h1>
      <p>ì•”ê¸° íŠ¸ë ˆì´ë„ˆ</p>
    </section>

    <div class="separator"></div>

    <section>
      <h2>ì§„í–‰ í˜„í™©</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <h3>ì§„ë„ìœ¨</h3>
          <div class="num" id="progress">0%</div>
        </div>
        <div class="stat-card">
          <h3>ì™„ë£Œ</h3>
          <div class="num" id="done">0</div>
        </div>
        <div class="stat-card">
          <h3>ì „ì²´</h3>
          <div class="num" id="total">1033</div>
        </div>
      </div>
    </section>

    <section>
      <h2>í•™ìŠµ ëª¨ë“œ ì„ íƒ</h2>
      <div class="mode-grid">
        <a href="/urani/study/minbub/trace/" class="mode-card">
          <div class="icon">âœï¸</div>
          <h2>ë”°ë¼ì“°ê¸°</h2>
          <p>ì •ë‹µì„ ë³´ë©´ì„œ ë”°ë¼ ì“°ê¸°</p>
        </a>
        <a href="/urani/study/minbub/test/" class="mode-card">
          <div class="icon">ğŸ’ª</div>
          <h2>ì•”ê¸°í…ŒìŠ¤íŠ¸</h2>
          <p>ì •ë‹µ ì—†ì´ ì•”ê¸°í•´ì„œ ì“°ê¸°</p>
        </a>
        <a href="/urani/study/minbub/status/" class="mode-card">
          <div class="icon">ğŸ“Š</div>
          <h2>ì•”ê¸°í˜„í™©</h2>
          <p>í•™ìŠµ ì§„ë„ í™•ì¸</p>
        </a>
      </div>
    </section>
  </div>
</main>

<footer>
  <div class="container">
    <p>&copy; 2026 Bobo's Home</p>
  </div>
</footer>

<!-- Login Modal -->
<div class="modal-bg" id="login-modal" onclick="if(event.target===this)closeLoginModal()">
  <div class="modal">
    <h2>â˜ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™”</h2>
    <p>ì•”í˜¸ë¥¼ ì…ë ¥í•˜ë©´ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œë„ ì§„ë„ë¥¼ ì´ì–´ì„œ ë³¼ ìˆ˜ ìˆì–´ìš”</p>
    <label>ì•”í˜¸ (4ì ì´ìƒ)</label>
    <input type="password" id="login-password" placeholder="ì•”í˜¸ ì…ë ¥">
    <div id="login-error" class="error"></div>
    <div class="btn-group">
      <button class="btn" onclick="handleLogin()">ë¡œê·¸ì¸</button>
      <button class="btn btn-ghost" onclick="closeLoginModal()">ì·¨ì†Œ</button>
    </div>
    <p class="hint">ğŸ’¡ ê°™ì€ ì•”í˜¸ë¡œ ëª¨ë“  ê¸°ê¸°ì—ì„œ ì ‘ì†í•˜ì„¸ìš”</p>
  </div>
</div>

<script type="module">
// Firebase imports
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
import { getFirestore, doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAaMrOed3Zhj4ceappFkMozjYBF-CYx4g8",
  authDomain: "urani-study.firebaseapp.com",
  projectId: "urani-study",
  storageBucket: "urani-study.firebasestorage.app",
  messagingSenderId: "595550201149",
  appId: "1:595550201149:web:328525a314582c70ac5154"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let currentUserId = null;

// Hash password to create user ID
async function hashPassword(password) {
  const encoder = new TextEncoder();
  const data = encoder.encode(password);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

// Load progress data
function loadProgress() {
  try {
    const s = localStorage.getItem('mb2');
    const state = s ? JSON.parse(s) : {};

    let done = 0;
    let total = 1033;

    Object.values(state).forEach(item => {
      if (item.s === 'mastered') done++;
    });

    const progress = total ? Math.round(done / total * 100) : 0;

    document.getElementById('progress').textContent = progress + '%';
    document.getElementById('done').textContent = done;
    document.getElementById('total').textContent = total;
  } catch (e) {
    console.error('Load error:', e);
  }
}

// Restore login state
function restoreLoginState() {
  const savedUserId = localStorage.getItem('currentUserId');
  if (savedUserId) {
    currentUserId = savedUserId;
    document.getElementById('login-btn').style.display = 'none';
    document.getElementById('user-info').style.display = 'inline';
    document.getElementById('logout-btn').style.display = 'inline';
  }
}

// Login/Logout functions
window.showLoginModal = function() {
  document.getElementById('login-modal').classList.add('show');
  document.getElementById('login-password').value = '';
  document.getElementById('login-error').style.display = 'none';
  setTimeout(() => document.getElementById('login-password').focus(), 100);
}

window.closeLoginModal = function() {
  document.getElementById('login-modal').classList.remove('show');
}

window.handleLogin = async function() {
  const password = document.getElementById('login-password').value;
  const errorEl = document.getElementById('login-error');

  if (!password || password.length < 4) {
    errorEl.textContent = 'ì•”í˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•´ìš”';
    errorEl.style.display = 'block';
    return;
  }

  try {
    currentUserId = await hashPassword(password);
    const docRef = doc(db, 'users', currentUserId);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const cloudData = docSnap.data();
      localStorage.setItem('mb2', JSON.stringify(cloudData.progress || {}));
      alert('â˜ï¸ í´ë¼ìš°ë“œì—ì„œ ì§„ë„ë¥¼ ë¶ˆëŸ¬ì™”ì–´ìš”!');
    } else {
      const state = JSON.parse(localStorage.getItem('mb2') || '{}');
      await setDoc(docRef, { progress: state, createdAt: Date.now(), lastUpdated: Date.now() });
      alert('âœ¨ ìƒˆë¡œìš´ ê³„ì •ì´ ë§Œë“¤ì–´ì¡Œì–´ìš”!\nì´ì œ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œë„ ê°™ì€ ì•”í˜¸ë¡œ ë¡œê·¸ì¸í•˜ë©´ ì§„ë„ê°€ ë™ê¸°í™”ë©ë‹ˆë‹¤.');
    }

    localStorage.setItem('currentUserId', currentUserId);
    document.getElementById('login-btn').style.display = 'none';
    document.getElementById('user-info').style.display = 'inline';
    document.getElementById('logout-btn').style.display = 'inline';
    closeLoginModal();
    loadProgress();
  } catch (e) {
    console.error('Login error:', e);
    errorEl.textContent = 'ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + e.message;
    errorEl.style.display = 'block';
  }
}

window.handleLogout = function() {
  if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ì–´ìš”?\në¡œì»¬ ì§„ë„ëŠ” ìœ ì§€ë˜ì§€ë§Œ í´ë¼ìš°ë“œ ë™ê¸°í™”ëŠ” ì¤‘ì§€ë©ë‹ˆë‹¤.')) {
    currentUserId = null;
    localStorage.removeItem('currentUserId');
    document.getElementById('login-btn').style.display = 'inline';
    document.getElementById('user-info').style.display = 'none';
    document.getElementById('logout-btn').style.display = 'none';
  }
}

// Initialize
restoreLoginState();
loadProgress();

// Section animations
const sections = document.querySelectorAll('main section');
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add('in-view');
    }
  });
}, { threshold: 0.1 });

sections.forEach(section => {
  observer.observe(section);
});
</script>

</body>
</html>
